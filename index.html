<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ÿ™ÿ∑ÿ®ŸäŸÇ ÿ¨Ÿäÿ® - ŸÇÿßÿ¶ŸÖÿ© ÿ™ÿ≥ŸàŸÇ ÿßŸÑÿπŸäŸÑÿ©</title>

    <!-- ÿÆÿ∑ ÿ™ÿ¨ŸàÿßŸÑ -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800;900&display=swap"
        rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        cream: {
                            50: '#fdfbf7',
                            100: '#f7f3e8',
                            200: '#efe6d0',
                        },
                        sage: {
                            500: '#7c9473',
                            600: '#657a5e',
                            700: '#4e6149',
                        },
                        peach: {
                            400: '#ff9e7d',
                            500: '#ff8b64',
                            600: '#e56c45',
                        },
                        dark: {
                            800: '#374151',
                            900: '#1f2937',
                        }
                    },
                    fontFamily: {
                        'tajawal': ['Tajawal', 'sans-serif'],
                    },
                    boxShadow: {
                        'soft': '0 10px 40px -10px rgba(124, 148, 115, 0.15)',
                        'inner-light': 'inset 0 2px 4px 0 rgba(255, 255, 255, 0.5)',
                    },
                    borderRadius: {
                        '3xl': '1.5rem',
                        '4xl': '2.5rem',
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out',
                        'slide-up': 'slideUp 0.5s cubic-bezier(0.16, 1, 0.3, 1)',
                        'pop': 'pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        },
                        pop: {
                            '0%': { transform: 'scale(0.95)' },
                            '50%': { transform: 'scale(1.1)' },
                            '100%': { transform: 'scale(1)' },
                        }
                    }
                },
            },
        }
    </script>

    <style>
        * {
            font-family: 'Tajawal', sans-serif;
            -webkit-tap-highlight-color: transparent;
            box-sizing: border-box;
        }

        body {
            background-color: #fdfbf7;
            color: #374151;
            /* pattern overlay opacity 0.4 */
            background-image: radial-gradient(#7c9473 0.5px, transparent 0.5px);
            background-size: 20px 20px;
        }

        /* Hide Scrollbar */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Custom SweetAlert Styles */
        div:where(.swal2-container) div:where(.swal2-popup) {
            border-radius: 2rem !important;
            font-family: 'Tajawal', sans-serif !important;
            background: #fdfbf7 !important;
        }

        div:where(.swal2-container) button:where(.swal2-styled).swal2-confirm {
            background-color: #ff8b64 !important;
            border-radius: 1rem !important;
            font-weight: bold !important;
        }

        .category-tab {
            transition: all 0.3s ease;
        }

        .category-tab.active {
            background-color: #7c9473;
            color: white;
            box-shadow: 0 8px 20px -6px rgba(124, 148, 115, 0.4);
            transform: translateY(-2px);
        }

        .item-card {
            background: white;
            transition: all 0.2s ease;
            border: 1px solid #f3f4f6;
        }

        .item-card.selected {
            border: 2px solid #7c9473;
            background: #f7f9f6;
        }

        .floating-action {
            box-shadow: 0 10px 30px -5px rgba(255, 139, 100, 0.4);
        }
    </style>
    <link rel="manifest" href="manifest.json">
    
    <link rel="apple-touch-icon" href="images (1).jfif">
    
    <link rel="icon" type="image/x-icon" href="images (1).jfif">
    
    <meta name="theme-color" content="#fdfbf7">
</head>

<body class="min-h-screen pb-40">

    <!-- Header -->
    <header class="sticky top-0 z-50 bg-white/90 backdrop-blur-md border-b border-sage-500/10 shadow-sm rounded-b-4xl">
        <div class="max-w-lg mx-auto p-5 pb-6">
            <div class="flex justify-between items-center">
                <div class="flex items-center gap-3">
                    <div class="w-12 h-12 bg-sage-500/10 rounded-full flex items-center justify-center text-sage-600">
                        <i data-lucide="chef-hat" class="w-7 h-7"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-black text-sage-600">ÿ™ÿ∑ÿ®ŸäŸÇ ÿ¨Ÿäÿ®</h1>
                        <p class="text-xs font-medium text-gray-400">ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿπŸäŸÑÿ© ‚Ä¢ <span id="current-date"></span></p>
                    </div>
                </div>

                <div class="flex gap-2">
                    <button onclick="toggleView()"
                        class="bg-cream-100 p-2.5 rounded-2xl hover:bg-cream-200 transition-colors text-sage-700">
                        <i id="view-icon" data-lucide="users" class="w-6 h-6"></i>
                    </button>
                </div>
            </div>

            <!-- Summary Card -->
            <div id="summary-card"
                class="mt-4 bg-sage-500 text-white p-4 rounded-3xl shadow-soft flex justify-between items-center transform transition-all">
                <div class="flex items-baseline gap-1">
                    <span id="header-count" class="text-3xl font-black">0</span>
                    <span class="text-sage-100 text-sm">ÿ∫ÿ±ÿ∂ ŸÅŸä ÿßŸÑÿ≥ŸÑÿ©</span>
                </div>
                <div class="bg-white/20 p-2 rounded-xl backdrop-blur-sm">
                    <i data-lucide="shopping-basket" class="w-6 h-6 text-white"></i>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-lg mx-auto p-4">

        <!-- SHOPPING LIST VIEW -->
        <div id="view-shopping" class="animate-fade-in">
            <!-- Search -->
            <div class="relative mb-6 group">
                <input type="text" id="search-input" placeholder="ÿ¥ŸÜŸà ŸÜÿßŸÇÿµ ÿßŸÑŸÖÿ∑ÿ®ÿÆ ÿßŸÑŸäŸàŸÖÿü"
                    class="w-full bg-white border-2 border-transparent focus:border-peach-400 rounded-3xl py-4 pr-12 pl-4 shadow-sm outline-none transition-all placeholder:text-gray-300 font-bold text-gray-600">
                <i data-lucide="search"
                    class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-300 w-5 h-5 group-focus-within:text-peach-400 transition-colors"></i>
            </div>

            <!-- Categories -->
            <div class="sticky top-[140px] z-40 bg-[#fdfbf7]/95 backdrop-blur-sm py-2 -mx-4 px-4 mb-4 overflow-hidden">
                <div id="categories-container" class="flex gap-2 overflow-x-auto no-scrollbar pb-2">
                    <!-- Javascript will populate this -->
                </div>
            </div>

            <!-- Items Grid -->
            <div id="items-grid" class="grid grid-cols-2 gap-3 pb-20">
                <!-- Javascript will populate this -->
            </div>

            <!-- Empty State -->
            <div id="empty-state" class="hidden text-center py-10 opacity-60">
                <i data-lucide="carrot" class="w-16 h-16 mx-auto text-gray-300 mb-2"></i>
                <p>ŸÖÿß ŸÑŸÇŸäÿ™ÿ¥ ÿßŸÑÿ∫ÿ±ÿ∂ Ÿáÿ∞ÿß Ÿäÿß ÿ£ŸÖŸä</p>
            </div>
        </div>

        <!-- FAMILY DIRECTORY VIEW -->
        <div id="view-family" class="hidden animate-fade-in pb-20">
            <div class="text-center mb-8">
                <h2 class="text-2xl font-bold text-sage-600 mb-2">ÿØŸÑŸäŸÑ ÿßŸÑÿ£ÿ®ŸÜÿßÿ°</h2>
                <p class="text-gray-400 text-sm">ÿ≥ÿ¨ŸÑŸä ÿ£ÿ±ŸÇÿßŸÖŸáŸÖ ÿ®ÿßÿ¥ ÿ™ÿ®ÿπÿ´Ÿä ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿ®ÿ≥ÿ±ÿπÿ©</p>
            </div>

            <div id="family-list" class="space-y-3 mb-8">
                <!-- Family members here -->
            </div>

            <button onclick="addFamilyMember()"
                class="w-full py-4 border-2 border-dashed border-sage-500/30 rounded-3xl text-sage-600 font-bold hover:bg-sage-50 transition-colors flex items-center justify-center gap-2">
                <i data-lucide="plus-circle" class="w-5 h-5"></i>
                ÿ•ÿ∂ÿßŸÅÿ© ÿßÿ®ŸÜ ÿ¨ÿØŸäÿØ
            </button>
        </div>

    </main>

    <!-- Bottom Actions Bar -->
    <div id="action-bar"
        class="fixed bottom-6 left-4 right-4 max-w-lg mx-auto z-40 flex gap-3 transition-transform duration-300 translate-y-32">
        <button onclick="copyList()"
            class="bg-white text-sage-600 w-14 h-14 rounded-full shadow-lg flex items-center justify-center hover:scale-105 transition-transform">
            <i data-lucide="copy" class="w-6 h-6"></i>
        </button>

        <button onclick="handleSend()"
            class="flex-1 bg-peach-500 text-white rounded-[2rem] shadow-soft shadow-peach-500/40 h-14 flex items-center justify-center gap-2 font-bold text-lg hover:scale-[1.02] active:scale-95 transition-all">
            <span>ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑŸÇÿßÿ¶ŸÖÿ©</span>
            <i data-lucide="send" class="w-5 h-5 rtl:rotate-180"></i>
        </button>

        <button onclick="confirmClear()"
            class="bg-white text-red-400 w-14 h-14 rounded-full shadow-lg flex items-center justify-center hover:bg-red-50 transition-colors">
            <i data-lucide="trash-2" class="w-6 h-6"></i>
        </button>
    </div>

    <script>
        // --- DATA ---
        const DATA = [
            {
                id: 'cat1', title: 'ÿ£ÿ≥ÿßÿ≥Ÿäÿßÿ™', icon: 'flame', emoji: 'üî•',
                items: [
                    { id: 1, name: 'ÿÆÿ®ÿ≤', icon: 'ü•ñ', unit: 'ÿ±ÿ®ÿ∑ÿ©' },
                    { id: 2, name: 'ÿ®Ÿäÿ∂', icon: 'ü•ö', unit: 'ÿ∑ÿ®ŸÇ' },
                    { id: 3, name: 'ÿ≤Ÿäÿ™ ÿ∑ÿ®ÿÆ', icon: 'üåª', unit: 'ÿπŸÑÿ®ÿ©' },
                    { id: 4, name: 'ÿ≥ŸÉÿ±', icon: 'üç¨', unit: 'ŸÉŸäŸÑŸà' },
                    { id: 5, name: 'ÿ£ÿ±ÿ≤', icon: 'üçö', unit: 'ŸÉŸäÿ≥' },
                    { id: 6, name: 'ŸÖŸÑÿ≠', icon: 'üßÇ', unit: 'ŸÉŸäÿ≥' },
                    { id: 7, name: 'ÿ∑ÿ≠ŸäŸÜ', icon: 'üåæ', unit: 'ŸÉŸäÿ≥' },
                    { id: 8, name: 'ŸÖŸÉÿ±ŸàŸÜÿ©', icon: 'üçù', unit: 'ŸÉŸäÿ≥' },
                    { id: 9, name: 'ÿ¥ÿßŸä', icon: 'üçµ', unit: 'ÿπŸÑÿ®ÿ©' },
                    { id: 10, name: 'ÿ¥ÿπŸäÿ±Ÿäÿ©', icon: 'üçú', unit: 'ŸÉŸäÿ≥' },
                    { id: 11, name: 'ŸÉÿ≥ŸÉÿ≥Ÿä', icon: 'ü•ò', unit: 'ŸÉŸäÿ≥' },
                    { id: 12, name: 'ÿπÿØÿ≥', icon: 'ü´ò', unit: 'ŸÉŸäÿ≥' },
                ]
            },
            {
                id: 'cat2', title: 'ÿÆÿ∂ÿßÿ±', icon: 'leaf', emoji: 'ü•¨',
                items: [
                    { id: 20, name: 'ÿ∑ŸÖÿßÿ∑ŸÖ', icon: 'üçÖ', unit: 'ŸÉŸäŸÑŸà' },
                    { id: 21, name: 'ÿÆŸäÿßÿ±', icon: 'ü•í', unit: 'ŸÉŸäŸÑŸà' },
                    { id: 22, name: 'ÿ®ÿµŸÑ', icon: 'üßÖ', unit: 'ŸÉŸäŸÑŸà' },
                    { id: 23, name: 'ÿ®ÿ∑ÿßÿ∑ÿß', icon: 'ü•î', unit: 'ŸÉŸäŸÑŸà' },
                    { id: 24, name: 'ÿ´ŸàŸÖ', icon: 'üßÑ', unit: 'ÿ±ÿ£ÿ≥' },
                    { id: 25, name: 'ŸÅŸÑŸÅŸÑ ÿ£ÿÆÿ∂ÿ±', icon: 'ü´ë', unit: 'ŸÉŸäŸÑŸà' },
                    { id: 26, name: 'ŸÑŸäŸÖŸàŸÜ', icon: 'üçã', unit: 'ŸÉŸäŸÑŸà' },
                    { id: 27, name: 'ÿ®ÿßÿ∞ŸÜÿ¨ÿßŸÜ', icon: 'üçÜ', unit: 'ŸÉŸäŸÑŸà' },
                    { id: 28, name: 'ŸÉŸàÿ≥ÿß', icon: 'ü•í', unit: 'ŸÉŸäŸÑŸà' },
                    { id: 29, name: 'ÿ¨ÿ≤ÿ±', icon: 'ü•ï', unit: 'ŸÉŸäŸÑŸà' },
                    { id: 30, name: 'ÿÆÿ≥', icon: 'ü•¨', unit: 'ÿ≠ÿ®ÿ©' },
                    { id: 31, name: 'ÿ®ŸÇÿØŸàŸÜÿ≥', icon: 'üåø', unit: 'ÿ±ÿ®ÿ∑ÿ©' },
                    { id: 32, name: 'ŸÉÿ≤ÿ®ÿ±ÿ©', icon: 'üåø', unit: 'ÿ±ÿ®ÿ∑ÿ©' },
                    { id: 33, name: 'ŸÜÿπŸÜÿßÿπ', icon: 'üå±', unit: 'ÿ±ÿ®ÿ∑ÿ©' },
                    { id: 34, name: 'ŸÅÿ¨ŸÑ', icon: 'ü•ï', unit: 'ÿ±ÿ®ÿ∑ÿ©' },
                    { id: 35, name: 'ŸÖŸÑŸÅŸàŸÅ', icon: 'ü•¨', unit: 'ÿ≠ÿ®ÿ©' },
                ]
            },
            {
                id: 'cat3', title: 'ŸÑÿ≠ŸàŸÖ', icon: 'beef', emoji: 'ü•©',
                items: [
                    { id: 40, name: 'ÿØÿ¨ÿßÿ¨ ŸÉÿßŸÖŸÑ', icon: 'üçó', unit: 'ÿ≠ÿ®ÿ©' },
                    { id: 41, name: 'ÿµÿØŸàÿ± ÿØÿ¨ÿßÿ¨', icon: 'üçó', unit: 'ŸÉŸäŸÑŸà' },
                    { id: 42, name: 'ÿ£ŸÅÿÆÿßÿ∞ ÿØÿ¨ÿßÿ¨', icon: 'üçó', unit: 'ŸÉŸäŸÑŸà' },
                    { id: 43, name: 'ŸÑÿ≠ŸÖ ÿ∫ŸÜŸÖ', icon: 'üçñ', unit: 'ŸÉŸäŸÑŸà' },
                    { id: 44, name: 'ŸÑÿ≠ŸÖ ÿ®ŸÇÿ±', icon: 'ü•©', unit: 'ŸÉŸäŸÑŸà' },
                    { id: 45, name: 'ŸÑÿ≠ŸÖ ŸÖŸÅÿ±ŸàŸÖ', icon: 'üçî', unit: 'ŸÉŸäŸÑŸà' },
                    { id: 46, name: 'ŸÉÿ®ÿØÿ©', icon: 'ü´Ä', unit: 'ŸÉŸäŸÑŸà' },
                    { id: 47, name: 'ÿ≥ŸÖŸÉ', icon: 'üêü', unit: 'ŸÉŸäŸÑŸà' },
                    { id: 48, name: 'ÿ¨ŸÖÿ®ÿ±Ÿä', icon: 'ü¶ê', unit: 'ŸÉŸäŸÑŸà' },
                    { id: 49, name: 'ÿ≥ÿ¨ŸÇ', icon: 'üå≠', unit: 'ŸÉŸäŸÑŸà' },
                    { id: 50, name: 'ŸÜŸÇÿßŸÜŸÇ', icon: 'üå≠', unit: 'ÿ®ÿßŸÉŸà' },
                ]
            },
            {
                id: 'cat4', title: 'ÿ£ŸÑÿ®ÿßŸÜ', icon: 'milk', emoji: 'ü•õ',
                items: [
                    { id: 60, name: 'ÿ≠ŸÑŸäÿ® ÿ∑ÿßÿ≤ÿ¨', icon: 'ü•õ', unit: 'ŸÑÿ™ÿ±' },
                    { id: 61, name: 'ÿ≠ŸÑŸäÿ® ÿ®ŸàÿØÿ±ÿ©', icon: 'ü•õ', unit: 'ÿπŸÑÿ®ÿ©' },
                    { id: 62, name: 'ÿ≤ÿ®ÿßÿØŸä', icon: 'ü•£', unit: 'ÿπŸÑÿ®ÿ©' },
                    { id: 63, name: 'ŸÑÿ®ŸÜÿ©', icon: 'ü•£', unit: 'ÿπŸÑÿ®ÿ©' },
                    { id: 64, name: 'ÿ¨ÿ®ŸÜÿ© ÿ®Ÿäÿ∂ÿßÿ°', icon: 'üßÄ', unit: 'ÿπŸÑÿ®ÿ©' },
                    { id: 65, name: 'ÿ≤ÿ®ÿØÿ©', icon: 'üßà', unit: 'ÿ≠ÿ®ÿ©' },
                    { id: 66, name: 'ŸÇÿ¥ÿ∑ÿ©', icon: 'üçØ', unit: 'ÿπŸÑÿ®ÿ©' },
                    { id: 67, name: 'ÿ≠ŸÑŸäÿ® ŸÖŸÉÿ´ŸÅ', icon: 'ü•´', unit: 'ÿπŸÑÿ®ÿ©' },
                    { id: 68, name: 'ÿ±Ÿàÿ®', icon: 'ü•õ', unit: 'ÿπŸÑÿ®ÿ©' },
                ]
            },
            {
                id: 'cat5', title: 'ŸÅŸàÿßŸÉŸá', icon: 'cherry', emoji: 'üçé',
                items: [
                    { id: 70, name: 'ÿ™ŸÅÿßÿ≠', icon: 'üçé', unit: 'ŸÉŸäŸÑŸà' },
                    { id: 71, name: 'ŸÖŸàÿ≤', icon: 'üçå', unit: 'ŸÉŸäŸÑŸà' },
                    { id: 72, name: 'ÿ®ÿ±ÿ™ŸÇÿßŸÑ', icon: 'üçä', unit: 'ŸÉŸäŸÑŸà' },
                    { id: 73, name: 'ÿπŸÜÿ®', icon: 'üçá', unit: 'ŸÉŸäŸÑŸà' },
                    { id: 74, name: 'ŸÖÿßŸÜÿ¨Ÿà', icon: 'ü•≠', unit: 'ŸÉŸäŸÑŸà' },
                    { id: 75, name: 'ŸÅÿ±ÿßŸàŸÑÿ©', icon: 'üçì', unit: 'ÿ∑ÿ®ŸÇ' },
                    { id: 76, name: 'ÿ®ÿ∑ŸäÿÆ', icon: 'üçâ', unit: 'ÿ≠ÿ®ÿ©' },
                    { id: 77, name: 'ÿ¥ŸÖÿßŸÖ', icon: 'üçà', unit: 'ÿ≠ÿ®ÿ©' },
                    { id: 78, name: 'ÿ±ŸÖÿßŸÜ', icon: 'ü´ê', unit: 'ŸÉŸäŸÑŸà' },
                    { id: 79, name: 'ÿ™ŸÖÿ±', icon: 'üå¥', unit: 'ŸÉŸäŸÑŸà' },
                    { id: 80, name: 'ÿ™ŸäŸÜ', icon: 'ü´ê', unit: 'ŸÉŸäŸÑŸà' },
                ]
            },
            {
                id: 'cat6', title: 'ŸÖÿπŸÑÿ®ÿßÿ™', icon: 'package', emoji: 'ü•´',
                items: [
                    { id: 90, name: 'ÿ∑ŸÖÿßÿ∑ŸÖ ÿ≠ŸÉŸÉ', icon: 'ü•´', unit: 'ÿπŸÑÿ®ÿ©' },
                    { id: 91, name: 'ÿµŸÑÿµÿ© ÿ∑ŸÖÿßÿ∑ŸÖ', icon: 'ü•´', unit: 'ÿπŸÑÿ®ÿ©' },
                    { id: 92, name: 'ÿ™ŸÜ (ÿ™ŸàŸÜÿ©)', icon: 'üêü', unit: 'ÿπŸÑÿ®ÿ©' },
                    { id: 93, name: 'Ÿáÿ±Ÿäÿ≥ÿ© ŸÑŸäÿ®Ÿäÿ©', icon: 'üå∂Ô∏è', unit: 'ÿπŸÑÿ®ÿ©' },
                    { id: 94, name: 'ŸÅÿßÿµŸàŸÑŸäÿß ŸÖÿπŸÑÿ®ÿ©', icon: 'ü´ò', unit: 'ÿπŸÑÿ®ÿ©' },
                    { id: 95, name: 'ÿ®ÿßÿ≤ŸÑÿßÿ° ŸÖÿπŸÑÿ®ÿ©', icon: 'ü´õ', unit: 'ÿπŸÑÿ®ÿ©' },
                    { id: 96, name: 'ÿ∞ÿ±ÿ© ŸÖÿπŸÑÿ®ÿ©', icon: 'üåΩ', unit: 'ÿπŸÑÿ®ÿ©' },
                    { id: 97, name: 'ÿ≤Ÿäÿ™ŸàŸÜ', icon: 'ü´í', unit: 'ÿπŸÑÿ®ÿ©' },
                    { id: 98, name: 'ŸÖÿÆŸÑŸÑ', icon: 'ü•í', unit: 'ÿ®ÿ±ÿ∑ŸÖÿßŸÜ' },
                    { id: 99, name: 'ŸÅŸàŸÑ ŸÖÿØŸÖÿ≥', icon: 'ü´ò', unit: 'ÿπŸÑÿ®ÿ©' },
                    { id: 100, name: 'ÿ≠ŸÖÿµ ŸÖÿπŸÑÿ®', icon: 'ü´ò', unit: 'ÿπŸÑÿ®ÿ©' },
                    { id: 101, name: 'ÿ≥ÿ±ÿØŸäŸÜ', icon: 'üêü', unit: 'ÿπŸÑÿ®ÿ©' },
                ]
            },
            {
                id: 'cat7', title: 'ŸÇŸáŸàÿ© ŸàŸÖŸÜÿ®Ÿáÿßÿ™', icon: 'coffee', emoji: '‚òï',
                items: [
                    { id: 110, name: 'ŸÜÿ≥ŸÉÿßŸÅŸäŸá', icon: '‚òï', unit: 'ÿπŸÑÿ®ÿ©' },
                    { id: 111, name: 'ÿ®ŸÜ Ÿàÿ∑ŸÜŸä', icon: '‚òï', unit: 'ŸÉŸäÿ≥' },
                    { id: 112, name: 'ÿ®ŸÜ ÿ™ÿ±ŸÉŸä', icon: '‚òï', unit: 'ŸÉŸäÿ≥' },
                    { id: 113, name: 'ÿ≤Ÿáÿ± (ÿ¥ÿßŸä ÿ£ÿÆÿ∂ÿ±)', icon: 'üçµ', unit: 'ÿπŸÑÿ®ÿ©' },
                    { id: 114, name: 'ŸÉÿßŸÉÿßŸà', icon: 'üç´', unit: 'ÿπŸÑÿ®ÿ©' },
                    { id: 115, name: 'ÿ¥ÿßŸä ŸÑŸäÿ®ÿ™ŸàŸÜ', icon: 'üçµ', unit: 'ÿπŸÑÿ®ÿ©' },
                    { id: 116, name: 'ÿ¥ÿßŸä ÿ£ÿ≠ŸÖÿ±', icon: 'üçµ', unit: 'ÿπŸÑÿ®ÿ©' },
                    { id: 117, name: 'ŸÜÿπŸÜÿßÿπ ŸÖÿ¨ŸÅŸÅ', icon: 'üåø', unit: 'ŸÉŸäÿ≥' },
                    { id: 118, name: 'ŸÉÿ±ŸäŸÖÿ±', icon: 'ü•õ', unit: 'ÿπŸÑÿ®ÿ©' },
                    { id: 119, name: 'ÿ≥ŸÉÿ± ÿ®ŸÜŸä', icon: 'üç¨', unit: 'ŸÉŸäÿ≥' },
                ]
            },
            {
                id: 'cat8', title: 'ŸÖÿÆÿ®Ÿàÿ≤ÿßÿ™', icon: 'croissant', emoji: 'ü•ê',
                items: [
                    { id: 130, name: 'ÿÆÿ®ÿ≤ ÿ¥ÿπŸäÿ±', icon: 'üçû', unit: 'ÿ±ÿ®ÿ∑ÿ©' },
                    { id: 131, name: 'ÿÆÿ®ÿ≤ ÿ™ŸÜŸàÿ±', icon: 'ü´ì', unit: 'ÿ≠ÿ®ÿ©' },
                    { id: 132, name: 'ÿ®ÿ±ŸäŸàÿ¥', icon: 'ü•ê', unit: 'ÿ≠ÿ®ÿ©' },
                    { id: 133, name: 'ŸÉÿπŸÉ ŸÖÿßŸÑÿ≠', icon: 'ü•®', unit: 'ŸÉŸäÿ≥' },
                    { id: 134, name: 'ÿµŸÖŸàŸÜ', icon: 'ü•ñ', unit: 'ÿ≠ÿ®ÿ©' },
                    { id: 135, name: 'ÿ™Ÿàÿ≥ÿ™', icon: 'üçû', unit: 'ÿ®ÿßŸÉŸà' },
                    { id: 136, name: 'ŸÉÿπŸÉ ÿ≠ŸÑŸà', icon: 'üç©', unit: 'ŸÉŸäÿ≥' },
                    { id: 137, name: 'ŸÅÿ∑Ÿäÿ±ÿ©', icon: 'ü•ß', unit: 'ÿ≠ÿ®ÿ©' },
                    { id: 138, name: 'ÿÆÿ®ÿ≤ ÿ®ÿ±ÿ¨ÿ±', icon: 'üçî', unit: 'ÿ®ÿßŸÉŸà' },
                    { id: 139, name: 'ÿÆÿ®ÿ≤ ÿµÿßÿ¨', icon: 'ü´ì', unit: 'ÿ®ÿßŸÉŸà' },
                ]
            },
            {
                id: 'cat9', title: 'ÿ≠ŸÑŸàŸäÿßÿ™ ŸàŸÖÿ¥ÿ±Ÿàÿ®ÿßÿ™', icon: 'candy', emoji: 'üç´',
                items: [
                    { id: 150, name: 'ÿ¥ŸàŸÉŸàŸÑÿßÿ™ÿ©', icon: 'üç´', unit: 'ÿ≠ÿ®ÿ©' },
                    { id: 151, name: 'ÿ®ÿ≥ŸÉŸàŸäÿ™ ŸÖÿßŸÉÿßŸà', icon: 'üç™', unit: 'ÿ®ÿßŸÉŸà' },
                    { id: 152, name: 'ÿ®ÿ≥ŸÉŸàŸäÿ™ ÿ£Ÿàÿ±ŸäŸà', icon: 'üç™', unit: 'ÿ®ÿßŸÉŸà' },
                    { id: 153, name: 'ÿπÿµŸäÿ± ÿ±ÿßŸÜŸä', icon: 'üßÉ', unit: 'ÿπŸÑÿ®ÿ©' },
                    { id: 154, name: 'ÿπÿµŸäÿ± ÿ≥ÿßŸÜÿ™Ÿàÿ®', icon: 'üßÉ', unit: 'ÿ®ÿßŸÉŸà' },
                    { id: 155, name: 'ŸÖÿ¥ÿ±Ÿàÿ® ÿ∫ÿßÿ≤Ÿä', icon: 'ü•§', unit: 'ÿπŸÑÿ®ÿ©' },
                    { id: 156, name: 'ŸÉŸäŸÉ ÿ¨ÿßŸáÿ≤', icon: 'üç∞', unit: 'ÿπŸÑÿ®ÿ©' },
                    { id: 157, name: 'ÿ±ŸÇÿßÿ¶ŸÇ ÿ¥Ÿäÿ®ÿ≥', icon: 'ü•î', unit: 'ÿ®ÿßŸÉŸà' },
                    { id: 158, name: 'ŸÖŸÉÿ≥ÿ±ÿßÿ™', icon: 'ü•ú', unit: 'ŸÉŸäÿ≥' },
                    { id: 159, name: 'ÿ≠ŸÑÿßŸàÿ© ÿ∑ÿ≠ŸäŸÜŸäÿ©', icon: 'üçØ', unit: 'ÿπŸÑÿ®ÿ©' },
                    { id: 160, name: 'ŸÖÿ±ÿ®Ÿâ', icon: 'üçì', unit: 'ÿ®ÿ±ÿ∑ŸÖÿßŸÜ' },
                    { id: 161, name: 'ÿπÿ≥ŸÑ', icon: 'üçØ', unit: 'ÿ®ÿ±ÿ∑ŸÖÿßŸÜ' },
                    { id: 162, name: 'ŸÜŸàÿ™ŸäŸÑÿß', icon: 'üç´', unit: 'ÿ®ÿ±ÿ∑ŸÖÿßŸÜ' },
                ]
            },
            {
                id: 'cat10', title: 'ÿ£ÿ¨ÿ®ÿßŸÜ ÿ±ÿßŸÇŸäÿ©', icon: 'slice', emoji: 'üßÄ',
                items: [
                    { id: 170, name: 'ÿ¨ÿ®ŸÜÿ© ŸÅŸäÿ™ÿß', icon: 'üßÄ', unit: 'ÿπŸÑÿ®ÿ©' },
                    { id: 171, name: 'ÿ¨ÿ®ŸÜÿ© ŸÖŸàÿ≤ÿßÿ±ŸäŸÑÿß', icon: 'üßÄ', unit: 'ŸÉŸäÿ≥' },
                    { id: 172, name: 'ÿ¨ÿ®ŸÜÿ© ŸÖÿ´ŸÑÿ´ÿßÿ™', icon: 'üßÄ', unit: 'ÿπŸÑÿ®ÿ©' },
                    { id: 173, name: 'ÿ¨ÿ®ŸÜÿ© ÿ•ŸäÿØÿßŸÖ', icon: 'üßÄ', unit: 'ÿ≠ÿ®ÿ©' },
                    { id: 174, name: 'ÿ¨ÿ®ŸÜÿ© ÿ¥ŸäÿØÿ±', icon: 'üßÄ', unit: 'ÿ®ÿßŸÉŸà' },
                    { id: 175, name: 'ÿ¨ÿ®ŸÜÿ© ŸÉÿ±ŸäŸÖŸä', icon: 'üßÄ', unit: 'ÿπŸÑÿ®ÿ©' },
                    { id: 176, name: 'ÿ¨ÿ®ŸÜÿ© ÿ≠ŸÑŸàŸÖ', icon: 'üßÄ', unit: 'ÿ®ÿßŸÉŸà' },
                    { id: 177, name: 'ÿ¨ÿ®ŸÜÿ© ŸÇÿ±Ÿäÿ¥', icon: 'üßÄ', unit: 'ÿπŸÑÿ®ÿ©' },
                    { id: 178, name: 'ÿ¨ÿ®ŸÜÿ© ÿπŸÉÿßŸàŸä', icon: 'üßÄ', unit: 'ŸÉŸäŸÑŸà' },
                ]
            },
            {
                id: 'cat11', title: 'ÿ®Ÿáÿßÿ±ÿßÿ™ Ÿàÿπÿ∑ÿßÿ±ÿ©', icon: 'flame', emoji: 'üå∂Ô∏è',
                items: [
                    { id: 190, name: 'ÿ®ÿ≤ÿßÿ± (ÿ®Ÿáÿßÿ±ÿßÿ™ ŸÖÿ¥ŸÉŸÑÿ©)', icon: 'ü´ô', unit: 'ŸÉŸäÿ≥' },
                    { id: 191, name: 'ÿ≠ÿ±ÿßÿ±ÿßÿ™ ŸÑŸäÿ®Ÿäÿ©', icon: 'üå∂Ô∏è', unit: 'ŸÉŸäÿ≥' },
                    { id: 192, name: 'ŸÅŸÑŸÅŸÑ ÿ£ÿ≠ŸÖÿ± ŸÖÿ∑ÿ≠ŸàŸÜ', icon: 'üå∂Ô∏è', unit: 'ŸÉŸäÿ≥' },
                    { id: 193, name: 'ŸÖŸÑÿ≠ ÿµÿÆÿ±Ÿä', icon: 'üßÇ', unit: 'ŸÉŸäÿ≥' },
                    { id: 194, name: 'ŸÉŸÖŸàŸÜ', icon: 'ü´ô', unit: 'ŸÉŸäÿ≥' },
                    { id: 195, name: 'ŸÉÿ±ŸÉŸÖ', icon: 'ü´ô', unit: 'ŸÉŸäÿ≥' },
                    { id: 196, name: 'ŸÇÿ±ŸÅÿ©', icon: 'ü´ô', unit: 'ŸÉŸäÿ≥' },
                    { id: 197, name: 'ÿ≤ŸÜÿ¨ÿ®ŸäŸÑ', icon: 'ü´ô', unit: 'ŸÉŸäÿ≥' },
                    { id: 198, name: 'ŸÅŸÑŸÅŸÑ ÿ£ÿ≥ŸàÿØ', icon: 'ü´ô', unit: 'ŸÉŸäÿ≥' },
                    { id: 199, name: 'Ÿàÿ±ŸÇ ÿ∫ÿßÿ±', icon: 'üåø', unit: 'ŸÉŸäÿ≥' },
                    { id: 200, name: 'ÿ≠ÿ®ŸáÿßŸÜ', icon: 'ü´ô', unit: 'ŸÉŸäÿ≥' },
                    { id: 201, name: 'ÿ≤ÿπÿ™ÿ±', icon: 'üåø', unit: 'ŸÉŸäÿ≥' },
                    { id: 202, name: 'ÿ≥ŸÖÿßŸÇ', icon: 'ü´ô', unit: 'ŸÉŸäÿ≥' },
                ]
            },
            {
                id: 'cat12', title: 'ÿπŸÜÿßŸäÿ© ÿ¥ÿÆÿµŸäÿ©', icon: 'sparkles', emoji: '‚ú®',
                items: [
                    { id: 220, name: 'ÿ¥ÿßŸÖÿ®Ÿà', icon: 'üß¥', unit: 'ÿπŸÑÿ®ÿ©' },
                    { id: 221, name: 'ÿ®ŸÑÿ≥ŸÖ ÿ¥ÿπÿ±', icon: 'üß¥', unit: 'ÿπŸÑÿ®ÿ©' },
                    { id: 222, name: 'ÿµÿßÿ®ŸàŸÜ ŸÇÿ∑ÿπ', icon: 'üßº', unit: 'ÿ≠ÿ®ÿ©' },
                    { id: 223, name: 'ÿµÿßÿ®ŸàŸÜ ÿ≥ÿßÿ¶ŸÑ', icon: 'üß¥', unit: 'ÿπŸÑÿ®ÿ©' },
                    { id: 224, name: 'ŸÖÿπÿ¨ŸàŸÜ ÿ£ÿ≥ŸÜÿßŸÜ', icon: 'ü™•', unit: 'ÿ≠ÿ®ÿ©' },
                    { id: 225, name: 'ŸÅÿ±ÿ¥ÿßÿ© ÿ£ÿ≥ŸÜÿßŸÜ', icon: 'ü™•', unit: 'ÿ≠ÿ®ÿ©' },
                    { id: 226, name: 'ÿ≠ŸÅÿßÿ∂ÿßÿ™ ÿ£ÿ∑ŸÅÿßŸÑ', icon: 'üë∂', unit: 'ÿ®ÿßŸÉŸà' },
                    { id: 227, name: 'ŸÖŸÜÿßÿØŸäŸÑ ŸÖÿ®ŸÑŸÑÿ©', icon: 'üßª', unit: 'ÿ®ÿßŸÉŸà' },
                    { id: 228, name: 'ŸÖÿ≤ŸäŸÑ ÿπÿ±ŸÇ', icon: 'üß¥', unit: 'ÿ≠ÿ®ÿ©' },
                    { id: 229, name: 'ŸÉÿ±ŸäŸÖ ŸÖÿ±ÿ∑ÿ®', icon: 'üß¥', unit: 'ÿπŸÑÿ®ÿ©' },
                    { id: 230, name: 'ŸÅŸàÿ∑ ÿµÿ≠Ÿäÿ©', icon: 'üì¶', unit: 'ÿ®ÿßŸÉŸà' },
                    { id: 231, name: 'ÿ¥ŸÅÿ±ÿßÿ™ ÿ≠ŸÑÿßŸÇÿ©', icon: 'ü™í', unit: 'ÿ®ÿßŸÉŸà' },
                    { id: 232, name: 'ŸÇÿ∑ŸÜ ÿ∑ÿ®Ÿä', icon: '‚òÅÔ∏è', unit: 'ÿ®ÿßŸÉŸà' },
                ]
            },
            {
                id: 'cat13', title: 'ÿ™ŸÜÿ∏ŸäŸÅ ÿßŸÑÿ®Ÿäÿ™', icon: 'home', emoji: 'üè†',
                items: [
                    { id: 250, name: 'ÿµÿßÿ®ŸàŸÜ ŸÖŸÑÿßÿ®ÿ≥', icon: 'üß∫', unit: 'ŸÉŸäÿ≥' },
                    { id: 251, name: 'ŸÖŸÜÿπŸÖ ŸÖŸÑÿßÿ®ÿ≥', icon: 'üß¥', unit: 'ÿπŸÑÿ®ÿ©' },
                    { id: 252, name: 'ÿ≥ÿßÿ¶ŸÑ ÿµÿ≠ŸàŸÜ', icon: 'üßº', unit: 'ÿπŸÑÿ®ÿ©' },
                    { id: 253, name: 'ŸÉŸÑŸàÿ±ŸÉÿ≥', icon: 'üß¥', unit: 'ÿπŸÑÿ®ÿ©' },
                    { id: 254, name: 'ŸÖŸÜÿßÿØŸäŸÑ Ÿàÿ±ŸÇŸäÿ©', icon: 'üßª', unit: 'ÿ®ÿßŸÉŸà' },
                    { id: 255, name: 'ÿ£ŸÉŸäÿßÿ≥ ÿ≤ÿ®ÿßŸÑÿ©', icon: 'üóëÔ∏è', unit: 'ÿ±ŸàŸÑ' },
                    { id: 256, name: 'ŸÖŸÜÿ∏ŸÅ ÿ£ÿ±ÿ∂Ÿäÿßÿ™', icon: 'üßπ', unit: 'ÿπŸÑÿ®ÿ©' },
                    { id: 257, name: 'ÿ≥ŸÅŸÜÿ¨ ÿ¨ŸÑŸä', icon: 'üßΩ', unit: 'ÿ®ÿßŸÉŸà' },
                    { id: 258, name: 'ŸÑŸäŸÅÿ©', icon: 'üßΩ', unit: 'ÿ≠ÿ®ÿ©' },
                    { id: 259, name: 'ŸÖÿπÿ∑ÿ± ÿ¨Ÿà', icon: 'üå∏', unit: 'ÿπŸÑÿ®ÿ©' },
                    { id: 260, name: 'ŸÇŸÅÿßÿ≤ÿßÿ™', icon: 'üß§', unit: 'ÿ®ÿßŸÉŸà' },
                    { id: 261, name: 'Ÿàÿ±ŸÇ ÿ£ŸÑŸÖŸÜŸäŸàŸÖ', icon: 'üìÑ', unit: 'ÿ±ŸàŸÑ' },
                    { id: 262, name: 'ÿ£ŸÉŸäÿßÿ≥ ÿ≠ŸÅÿ∏', icon: 'üì¶', unit: 'ÿ®ÿßŸÉŸà' },
                ]
            }
        ];

        // --- STATE ---
        let cart = JSON.parse(localStorage.getItem('jeeb_cart') || '{}');
        let family = JSON.parse(localStorage.getItem('jeeb_family') || '[]');
        let activeView = 'shopping'; // 'shopping' or 'family'
        let activeTab = DATA[0].id;
        let searchQuery = '';

        // --- INIT ---
        function init() {
            renderTabs();
            renderItems();
            renderFamily();
            updateUI();

            // Set Date
            const dateOpts = { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' };
            document.getElementById('current-date').innerText = new Date().toLocaleDateString('ar-LY', dateOpts);

            lucide.createIcons();
        }

        // --- UI RENDERING ---
        function renderTabs() {
            const container = document.getElementById('categories-container');
            container.innerHTML = DATA.map(cat => `
                <button 
                    onclick="setTab('${cat.id}')" 
                    class="category-tab px-6 py-3 rounded-2xl text-sm font-bold flex-shrink-0 flex items-center gap-2 ${activeTab === cat.id ? 'active' : 'bg-white text-gray-400 hover:bg-gray-50'}"
                >
                    <i data-lucide="${cat.icon}" class="w-4 h-4"></i>
                    ${cat.title}
                </button>
            `).join('');
            lucide.createIcons();
        }

        function renderItems() {
            const grid = document.getElementById('items-grid');
            const empty = document.getElementById('empty-state');

            let items = [];
            if (searchQuery) {
                // Fuzzy Search simplified
                const q = searchQuery.toLowerCase();
                DATA.forEach(c => {
                    c.items.forEach(i => {
                        if (i.name.includes(q)) items.push(i);
                    });
                });
            } else {
                items = DATA.find(c => c.id === activeTab)?.items || [];
            }

            if (items.length === 0) {
                grid.innerHTML = '';
                empty.classList.remove('hidden');
                return;
            }
            empty.classList.add('hidden');

            grid.innerHTML = items.map(item => {
                const count = cart[item.id] || 0;
                return `
                <div onclick="addToCart(${item.id})" class="item-card relative p-4 rounded-3xl cursor-pointer ${count > 0 ? 'selected' : ''}">
                    <!-- Decoration -->
                    <div class="absolute top-2 left-2 w-2 h-2 rounded-full ${count > 0 ? 'bg-peach-500' : 'bg-gray-100'}"></div>
                    
                    <div class="text-center mt-2 mb-3">
                        <div class="text-4xl mb-2">${item.icon || 'üì¶'}</div>
                        <h3 class="font-bold text-lg text-sage-900">${item.name}</h3>
                        <p class="text-xs text-gray-400">${item.unit}</p>
                    </div>

                    ${count === 0 ? `
                        <button class="w-full bg-cream-100 text-sage-600 py-2.5 rounded-xl font-bold text-sm hover:bg-cream-200 transition-colors">
                            ÿ¨Ÿäÿ®
                        </button>
                    ` : `
                        <div class="flex items-center justify-between bg-white rounded-xl overflow-hidden shadow-sm border border-gray-100" onclick="event.stopPropagation()">
                            <button onclick="updateCart(${item.id}, -1)" class="w-10 h-10 flex items-center justify-center text-red-400 hover:bg-red-50 text-lg font-bold">-</button>
                            <span class="font-black text-emerald-600">${count}</span>
                            <button onclick="updateCart(${item.id}, 1)" class="w-10 h-10 flex items-center justify-center text-emerald-600 hover:bg-emerald-50 text-lg font-bold">+</button>
                        </div>
                    `}
                </div>
                `;
            }).join('');
        }

        function renderFamily() {
            const container = document.getElementById('family-list');
            if (family.length === 0) {
                container.innerHTML = `
                    <div class="bg-white p-6 rounded-3xl text-center shadow-sm border border-dashed border-gray-200">
                        <p class="text-gray-400">ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ŸÅÿßÿ∂Ÿäÿ©ÿå ÿ∂ŸäŸÅŸä ÿ£ÿ≥ŸÖÿßÿ° ÿ£ÿ®ŸÜÿßÿ¶ŸÉ</p>
                    </div>
                `;
                return;
            }
            container.innerHTML = family.map((son, idx) => `
                <div class="bg-white p-4 rounded-3xl shadow-sm flex justify-between items-center border border-gray-50">
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 rounded-full bg-peach-100 text-peach-600 flex items-center justify-center font-bold text-xl">
                            ${son.name[0]}
                        </div>
                        <div>
                            <h3 class="font-bold text-gray-800">${son.name}</h3>
                            <p class="text-xs text-gray-400">${son.phone}</p>
                        </div>
                    </div>
                    <button onclick="removeFamily(${idx})" class="p-2 text-gray-300 hover:text-red-400">
                        <i data-lucide="x" class="w-5 h-5"></i>
                    </button>
                </div>
            `).join('');
            lucide.createIcons();
        }

        // --- ACTIONS ---
        function addToCart(id) {
            if (!cart[id]) updateCart(id, 1);
        }

        function updateCart(id, delta) {
            cart[id] = (cart[id] || 0) + delta;
            if (cart[id] <= 0) delete cart[id];
            localStorage.setItem('jeeb_cart', JSON.stringify(cart));
            renderItems();
            updateUI();
        }

        function updateUI() {
            const count = Object.keys(cart).length;
            document.getElementById('header-count').innerText = Object.values(cart).reduce((a, b) => a + b, 0);

            const bar = document.getElementById('action-bar');
            if (count > 0 && activeView === 'shopping') {
                bar.classList.remove('translate-y-32');
            } else {
                bar.classList.add('translate-y-32');
            }
        }

        function setTab(id) {
            activeTab = id;
            renderTabs();
            renderItems();
        }

        function toggleView() {
            activeView = activeView === 'shopping' ? 'family' : 'shopping';

            const btn = document.getElementById('view-icon');
            const shoppingDiv = document.getElementById('view-shopping');
            const familyDiv = document.getElementById('view-family');

            if (activeView === 'family') {
                btn.setAttribute('data-lucide', 'shopping-basket');
                shoppingDiv.classList.add('hidden');
                familyDiv.classList.remove('hidden');
            } else {
                btn.setAttribute('data-lucide', 'users');
                shoppingDiv.classList.remove('hidden');
                familyDiv.classList.add('hidden');
            }

            lucide.createIcons();
            updateUI();
        }

        // --- FAMILY FEATURES ---
        async function addFamilyMember() {
            const { value: formValues } = await Swal.fire({
                title: 'ÿ•ÿ∂ÿßŸÅÿ© ÿßÿ®ŸÜ ÿ¨ÿØŸäÿØ',
                html: `
                    <input id="swal-name" class="swal2-input" placeholder="ÿßŸÑÿßÿ≥ŸÖ (ŸÖÿ´ŸÑÿßŸã: ÿ£ÿ≠ŸÖÿØ)">
                    <input id="swal-phone" class="swal2-input" placeholder="ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ (218...)">
                `,
                focusConfirm: false,
                confirmButtonText: 'ÿ≠ŸÅÿ∏',
                showCancelButton: true,
                cancelButtonText: 'ÿ•ŸÑÿ∫ÿßÿ°',
                preConfirm: () => {
                    return [
                        document.getElementById('swal-name').value,
                        document.getElementById('swal-phone').value
                    ]
                }
            });

            if (formValues && formValues[0] && formValues[1]) {
                family.push({ name: formValues[0], phone: formValues[1] });
                localStorage.setItem('jeeb_family', JSON.stringify(family));
                renderFamily();
                Swal.fire({
                    icon: 'success',
                    title: 'ÿ™ŸÖÿ™ ÿßŸÑÿ•ÿ∂ÿßŸÅÿ©!',
                    toast: true,
                    position: 'top',
                    showConfirmButton: false,
                    timer: 2000
                });
            }
        }

        function removeFamily(idx) {
            Swal.fire({
                title: 'ŸÖÿ™ÿ£ŸÉÿØÿ© ÿ™ÿ®Ÿä ÿ™ÿ≠ÿ∞ŸÅŸäÿü',
                text: "ŸÑŸÜ ÿ™ÿ∏Ÿáÿ± ÿ®ŸäÿßŸÜÿßÿ™Ÿá ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'ŸÜÿπŸÖÿå ÿßÿ≠ÿ∞ŸÅŸä',
                cancelButtonText: 'ŸÑÿß'
            }).then((result) => {
                if (result.isConfirmed) {
                    family.splice(idx, 1);
                    localStorage.setItem('jeeb_family', JSON.stringify(family));
                    renderFamily();
                }
            });
        }

        // --- OUTPUT GENERATION ---
        function generateMessage() {
            let msg = `üõí *ŸÇÿßÿ¶ŸÖÿ© ŸÖÿ∑ÿ®ÿÆŸÜÿß ÿßŸÑŸäŸàŸÖ*:\n\n`;

            // Group by category Logic
            let grouped = {};
            for (let [id, qty] of Object.entries(cart)) {
                let item, cat;
                DATA.forEach(c => {
                    let found = c.items.find(i => i.id == id);
                    if (found) { item = found; cat = c; }
                });

                if (item) {
                    if (!grouped[cat.title]) grouped[cat.title] = [];
                    grouped[cat.title].push(`${item.name} (${qty} ${item.unit})`);
                }
            }

            for (let [catTitle, items] of Object.entries(grouped)) {
                msg += `üî∏ *${catTitle}*\n`;
                items.forEach(i => msg += `   - ${i}\n`);
                msg += '\n';
            }

            msg += `\nÿßŸÑŸÑŸá Ÿäÿ±ÿ∂Ÿâ ÿπŸÑŸäŸÉ Ÿäÿß ŸàŸÑÿØŸä ‚ù§Ô∏è`;
            return msg;
        }

        async function handleSend() {
            const msg = generateMessage();

            if (family.length > 0) {
                const inputOptions = {};
                family.forEach((son, idx) => {
                    inputOptions[idx] = son.name;
                });
                inputOptions['other'] = 'ÿ±ŸÇŸÖ ÿ¢ÿÆÿ± / ŸÖÿ¥ÿßÿ±ŸÉÿ© ÿπÿßŸÖÿ©';

                const { value: selectedIdx } = await Swal.fire({
                    title: 'ŸÑŸÖŸÜ ÿ™ÿ®Ÿä ÿ™ÿ®ÿπÿ´Ÿä ÿßŸÑŸÇÿßÿ¶ŸÖÿ©ÿü',
                    input: 'radio',
                    inputOptions: inputOptions,
                    inputValue: '0',
                    confirmButtonText: 'ÿ•ÿ±ÿ≥ÿßŸÑ',
                    showCancelButton: true,
                    cancelButtonText: 'ÿ•ŸÑÿ∫ÿßÿ°'
                });

                if (selectedIdx === undefined) return;

                if (selectedIdx === 'other') {
                    window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`);
                } else {
                    const son = family[selectedIdx];
                    let phone = son.phone.replace(/\D/g, '');
                    if (phone.startsWith('09')) phone = '218' + phone.substring(1);
                    if (phone.startsWith('9')) phone = '218' + phone;

                    const sonMsg = `Ÿäÿß ${son.name}ÿå \n` + msg;
                    window.open(`https://wa.me/${phone}?text=${encodeURIComponent(sonMsg)}`);
                }

            } else {
                window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`);
            }
        }

        function copyList() {
            const msg = generateMessage();
            navigator.clipboard.writeText(msg).then(() => {
                Swal.fire({
                    icon: 'success',
                    title: 'ÿ™ŸÖ ŸÜÿ≥ÿÆ ÿßŸÑŸÇÿßÿ¶ŸÖÿ©',
                    toast: true,
                    position: 'top',
                    showConfirmButton: false,
                    timer: 2000
                });
            });
        }

        function confirmClear() {
            Swal.fire({
                title: 'ÿ™ÿµŸÅŸäÿ± ÿßŸÑŸÇÿßÿ¶ŸÖÿ©ÿü',
                text: "ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØÿ© ŸÖŸÜ ŸÖÿ≥ÿ≠ ŸÉŸÑ ÿßŸÑÿ£ÿ∫ÿ±ÿßÿ∂ÿü",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#ff8b64',
                cancelButtonColor: '#d33',
                confirmButtonText: 'ŸÜÿπŸÖÿå ÿßŸÖÿ≥ÿ≠Ÿä',
                cancelButtonText: 'ÿ™ÿ±ÿßÿ¨ÿπ'
            }).then((result) => {
                if (result.isConfirmed) {
                    cart = {};
                    localStorage.setItem('jeeb_cart', JSON.stringify({}));
                    renderItems();
                    updateUI();
                    Swal.fire({
                        title: 'ÿ™ŸÖ ÿßŸÑŸÖÿ≥ÿ≠!',
                        icon: 'success',
                        toast: true,
                        position: 'top',
                        showConfirmButton: false,
                        timer: 1500
                    });
                }
            })
        }

        // Search Listener
        document.getElementById('search-input').addEventListener('input', (e) => {
            searchQuery = e.target.value.trim();
            renderItems();
        });

        // Start
        window.onload = init;
    </script>
</body>

</html>